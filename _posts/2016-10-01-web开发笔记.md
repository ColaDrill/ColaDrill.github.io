---
layout:     post
title:      web开发笔记
subtitle:   来自纸质的笔记本
date:       2016-10-01
author:     Jiayue Cai
header-img: img/post-bg-arch_linux2.png
catalog: true
tags:
    - Web

---

> Last updated on 2018-12-28...

> 很早很早之前的笔记，来自多页的内容，汇总到这篇，所以写的会很乱...

最早之前学开发的时候，只在微博和csdn上写过寥寥几篇，但并没有养成写博客习惯。

后来想做一些回顾的时候，最终还是发现纸质笔记没有博客来的实用，于是就从此开始督促自己养成写博客的习惯。

### MVC框架

用户首先在界面中进行人机交互，然后请求发送到控制器，控制器根据请求类型和请求的指令发送到相应的模型，模型可以与数据库进行交互，进行增删改查操作，完成之后，根据业务的逻辑选择相应的视图进行显示，此时用户获得此次交互的反馈信息，用户可以进行下一步交互，如此循环。
![](/img/post/20161001/1.jpg)

`Model模型`：模型表示业务规则。在MVC的三个部件中，模型拥有最多的处理任务。被模型返回的数据是中立的，模型与数据格式无关，这样一个模型能为多个视图提供数据，由于应用于模型的代码只需写一次就可以被多个视图重用，所以减少了代码的重复性。

`View视图`：用户看到并与之交互的界面。比如由html元素组成的网页界面，或者软件的客户端界面。MVC的好处之一在于它能为应用程序处理很多不同的视图。在视图中其实没有真正的处理发生，它只是作为一种输出数据并允许用户操纵的方式。

`Controller控制器`：控制器接受用户的输入并调用模型和视图去完成用户的需求，控制器本身不输出任何东西和做任何处理。它只是接收请求并决定调用哪个模型构件去处理请求，然后再确定用哪个视图来显示返回的数据。

> 竟然在面试MSRA算法岗的时候被问到了这个，凭借着自己模模糊糊的印象算是勉强答上来了...

### Maven组件

![](/img/post/20161001/2.png)

- `common 公用层`：一般公司都会有固定的jar，几个项目通用
- `dao 数据操作层`：DB操作都写在这
- `dmo 数据库交互持久层`
- `service 基本业务处理层`
- `war 页面层`：页面、配置文件以及最终发布的war包
- `web 页面交互层`
- ...xml                                                                                                                                                                    

### 通信组件

1、socket套接字（协议，IP地址，端口）：
- 套接字是平等的，即client与server无差别
- import java.net.Socket
- socket套接字（协议，IP地址，端口）
- socket是对TCP/IP协议的封装，本身不是协议，而是一个API

2、netty网络通讯框架
- 三层式架构：Reactor通信调度层（不同的Reactor Pool和Channel）、Pipeline职责链（不同的handler）、Service业务逻辑层（各种协议）
- socket + TCP + NIO + 职责链 + java并发包（阻塞队列）
- client发起请求到Reactor Thread Accepter，由它Dispatcher到Reactor Thread Pool线程池，然后队列由Handler负责read/write/decode

> 关于通信组件，大公司都会有自己的框架，本科实习的时候接触过，但是不能透露哈 

### Redis缓存

**key-value内存数据库**，在我们往redis上写数据的时候，redis服务也会定时的往文件中写数据。

**支持5种数据类型**：strings 字符串、lists 字符串列表、sets 字符串集合、 sorted sets 有序字符串集合、 hashes 哈希

**支持2种持久化**：RDB快照方式（Redis DataBase）、AOF指令复行方式（Append Only File）

**3种集群方案**：
- Redis Cluster（官方）：主从分离+选举算法
- Redis sharding 集群（Cluster之前）：哈希散列+一致性哈希算法
- Redis 代理中间件 twemproxy：request -> key-value -> Redis -> database

### SQL

**1、SQL语句的4个处理阶段:**（始末包含`创建游标open`和`关闭游标close`）
- `Prase 解析`：查共享池、检查语法/语义/权限、合并视图、子查询、确定执行计划
- `Bind 绑定`：查找绑定变量、赋值
- `Execute 执行`：执行、I/O、排序
- `Fetch 提取`：返回结果、排序、使用Array Fetch机制

**2、SQL共享原理：**
- Oracle将执行过的SQL语句存放在共享池内存中，再次访问时，先在内存池中找相同语句，从而用最好的执行方案执行操作。

> 可是，该功能并不适用于多表连接查询。

**3、重编译问题：**
- SQL访问一次，就要在内存中硬解析一次。

解决：绑定变量（硬解一次，重复调用） EXEC SQL PREPARE/EXECUTE/COMMIT ...

**4、调优领域：**（设计 > SQL语句 > 环境 > 实例）
- 应用程序级：SQL语句、管理变化 （应用程序开发人员）
- 实例级：内存、数据结构、实例配置（数据库管理员）
- 操作系统级：I/O、SWAP、Parameters（系统管理员）

**5、好的SQL语句：**简单&模块化、易读&易维护、节省资源、不造成死锁

### 数据库建表

1、xxID/xx号：VARCHAR2(32)，手机号（16），电话（16）

2、所在省份/城市：VARCHAR2(32)，所在地/地址（64）

3、学校名称/院系/校区/专业/班级：VARCHAR2(128)

4、xx标识：NUMBER(1)，xx状态：VARCHAR2(2)

5、姓名/用户名 VARCHAR2(32)，性别（4），邮箱（64）

6、xx原因：VARCHAR2(256)，xx附件（512）

7、xx次数：NUMBER

8、xx收入/费用：INTEGER

9、xx率：NUMBER(8,5)

10、xx额度/金额：NUMBER(14,2)

11、xx时间：DATE

12、是否xx：VARCHAR2(2)

### HTML

**1、标签**

```htmlbars
标题：<h1>...</h1>，h1到h6为从大到小
段落：<p></p>
链接：<a href="http://...">XX网站</a>
图像：<img src="img/title.png"/>
换行：<br/>
水平：线<hr/>
...
```

**2、块元素**

body, div, span, p, table, form

**3、表格**

```htmlbars
<table>
	<tr>
		<td>...</td>
	<tr>
<table>
```

**4、列表**

ol有序列表、ul无序列表、li列表元素

**5、布局**

div、table

**6、动作属性**

```htmlbars
<form name="input" action="xx.jsp" method="post">
Username:
	<input type="text" name="user"/>
</form>
```

### 项目流程

1、项目经理：写需求->需求评审->工作计划

2、版本控制操作员：拉分支->权限控制->打包相对路径

3、Jekins操作人员：配置打包环境、sonor扫描选项

4、QA质量管理专员：每天定时扫描代码质量并报告

### 其他知识

#### linux命令

> 常用的我就不写了，下面只留一些备用的

跑脚本：cat xx.txt &#124; python xx.py

自定义命令：
- vi ~/.bash_profile     #编辑：alias hdpn='/home/.../hadoop'
- source ~/.bash_profile #激活

编码显示问题：
- vi ~/.vimrc     #编辑：set fileencoding=utf-8,ucs-bom,gb18030,gbk,gb2312,cp936
- source ~/.vimrc #激活

<details>
<summary><mark>点击查看详细内容</mark></summary>
<br/>set incsearch
<br/>set hlsearch
<br/>set ignorecase smartcase
<br/>set backupcopy=yes
<br/>set laststatus=2
<br/>set fileencodings=utf-8,ucs-bom,gb18030,gbk,gb2312,cp936
<br/>set termencoding=utf-8
<br/>set encoding=utf-8
<br/>set number
<br/>set tabstop=4
<br/>set softtabstop=4
<br/>set shiftwidth=4
<br/>set expandtab
</details>


#### 字符编码

- ASCII：python默认编码，只能表示数字、英文字母和一些特殊符号，不能表示汉字（1字节）
- GB2312：中文编码（然后逐渐扩展为GBK、GB18030）（2字节）
- unicode：用于内存中存储，可表示汉字，固定长度（4字节）
- utf-8：用于磁盘文件存储，可表示汉字，可变长度（英文占用1字节，中文占用3字节）

> 详细讲解：[link1](https://www.cnblogs.com/tarol/p/7523642.html)、[link2](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html) 

#### 分布式算法

> 内容太多，这里只挑一部分简单罗列一下。

- 时钟：物理时钟Physical Clocks（实际应用）、逻辑时钟Logical Clocks、向量时钟Vector Clocks（学术理想）
- 以数据为中心的一致性模型：
	- 不使用同步操作的一致性：顺序一致性、因果一致性、FIFO队列一致性、严格一致性、线性一致性
	- 使用同步操作的一致性：弱一致性、释放一致性、入口一致性
- 以客户为中心的一致性模型：
	- 最终一致性：单调读（分布式电子邮件数据库）、单调写（windows 更新）、写后读（分布式web站点的页面更新问题）、读后写（分布式bbs系统的回帖问题）
- Mutual exclusion互斥：基于令牌、基于许可
- Fault Tolerance容错性：Availability可用性、Reliability可靠性、Safety安全性、Maintainability可维护性

#### 大数据计算框架

**1、批处理框架**：重点关心数据处理的吞吐量
- Map/Reduce（Hadoop）、DAG（Spark）、图计算（PowerGraph）

**2、流计算框架**：重点关心处理的实时性
- 实时（Storm、Flink）、小批量（Strom Trident、Spark Streaming）

> storm保证消息可靠性的过程：为每条消息分派一个ID作为唯一性标识，在生成和处理时`分别被异或一次`，则成功执行所有消息均`被异或两次`，因此最后状态为0，若不为0则中间出了问题。

**3、增量计算框架**：重点关心如何避免重复计算（如何只对部分新增数据进行计算，来极大提升计算过程的效率）
- Percolator、Kineograph、Galaxy

**4、交互式分析框架**：UI使用的方便性
- Hive、Kylin、Spark SQL、Flink Table

#### Hadoop

![](/img/post/20161001/3.jpg)

![](/img/post/20161001/4.png)

输入到每一个阶段均是键 - 值对。此外，每一个程序员需要指定两个函数：map函数和reduce函数，整个过程要经历三个阶段执行。


**1、输入拆分：**
- 输入到MapReduce工作被划分成固定大小的块叫做 input splits ，输入折分是由单个映射消费输入块。

**2、映射 - Mapping：**
- 这是在 map-reduce 程序执行的第一个阶段。在这个阶段中的每个分割的数据被传递给映射函数来产生输出值。在我们的例子中，映射阶段的任务是计算输入分割出现每个单词的数量(更多详细信息有关输入分割在下面给出)并编制以某一形式列表<单词，出现频率>

**3、重排：**
- 这个阶段消耗映射阶段的输出。它的任务是合并映射阶段输出的相关记录。在我们的例子，同样的词汇以及它们各自出现频率。

**4、Reducing：**
- 在这一阶段，从重排阶段输出值汇总。这个阶段结合来自重排阶段值，并返回一个输出值。总之，这一阶段汇总了完整的数据集。在我们的例子中，这个阶段汇总来自重排阶段的值，计算每个单词出现次数的总和。

Hadoop常用命令：（第一个...为源路径，后一个为目标路径，一般是本地路径）
- 访问：/hadoop fs `-ls` ...
- 合并拷贝至本地：/hadoop fs `-getmerge` ... ...
- 拷贝单文件：/hadoop fs `-get` .../part1 ...
- 访问并摘取一部分（100行）：/hadoop fs `-text` .../* &#124; head -n 100 `>>` sample.txt















