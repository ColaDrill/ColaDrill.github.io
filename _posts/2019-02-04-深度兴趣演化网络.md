---
layout:     post
title:      深度兴趣演化网络
subtitle:   From 阿里妈妈：定向广告新一代点击率预估主模型
date:       2019-02-04
author:     Jiayue Cai
header-img: img/post-bg-alibaba.jpg
catalog: true
tags:
    - Machine Learning
    - Recommending System
---


> Last updated on 2019-2-4... 未完待续，过年中...

承接半年多前看过的一篇：[《匹配&推荐技术》](https://coladrill.github.io/2018/08/06/%E5%8C%B9%E9%85%8D&%E6%8E%A8%E8%8D%90%E6%8A%80%E6%9C%AF/)

本篇为个人笔记。[》原文链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247487620&idx=1&sn=b3162fec93608788430f7e52236d998e&chksm=fbd4a2e8cca32bfea69c4e418e38d0c8709d2fe3395f74f73aaf48815ec8a41fc0d130ae4a1e&mpshare=1&scene=23&srcid=0129x9xxUUalmMVT9goaeEEi#rd)


### 业务形态 

当我们打开淘宝的时候，首先呈现的是一个banner形式的广告；在首页猜你喜欢场景下，或者购物链路的其他场景下，会出现一些单品的广告：在推荐的商品浏览列表，即`信息流场景`下，会在列表中穿插广告投放，且`投放位置固定`，这些广告将和正常推荐浏览的商品一起呈现出来。
![](/img/post/20190204/1.png)

> 如果广告的形态特别明显，会破坏用户的体验，比如浏览的顺畅感。所以，推荐用户感兴趣的东西，`使得用户感觉不到`广告的存在，是十分重要的。

#### 电商场景特性

在一般的广告建模里，通常根据`广告信息`、`用户信息`、`上下文信息`，去判断用户是否会点击这个广告。

区别于搜索广告这种用户带有明显意图的主动的query查询行为，**在展示广告业务场景下，用户并没有明确的意图。**

此时，应当如何建模，用户会有什么样的兴趣，了解并解决这些问题，对我们工作非常重要。
![](/img/post/20190204/2.png)


### 模型发展

![](/img/post/20190204/3.png)

#### 早期LR模型

非常复杂的特征工程

#### MLR模型

把LR模型分成多片，每片建模一部分数据，此方式相当于引入一部分非线性能力。

#### DNN模型

第一代神经网络ctr模型如图所示，第一层是非常简单的原生特征，包括：用户特征，候选广告特征，上下文特征。这些特征在经过lookup的方式做embedding之后,被concat一起，送入多层的dnn网络，最后做一个softmax。这是一个最基础的ctr神经网络模型。
![](/img/post/20190204/4.png)

在这种最简单的dnn模型基础之上，衍生出了非常多的其他的模型，比如DeepFm，做一些特征之间的交叉；pnn也是；然后是deep&wide模型，其中的deep部分可以通过多层MLP学习数据中的非线性规律，同时设计了wide部分以复用传统浅层模型时代保留下来的丰富的人工设计特征。

#### DIN模型

`深度兴趣网络`（Deep Interest Network）[KDD 2018](https://arxiv.org/abs/1706.06978v4)

根据用户的历史行为，我们看到用户的兴趣点是非常宽泛并且杂乱的。此时，在通用的Embedding&MLP范式下设计出的模型，是无法针对用户丰富多样的兴趣，做出特别操作的，**仅仅是把所有行为的Embedding sum在一起作为用户的历史行为表达。而这一操作存在大量信息损失。**

> 这里需要强调的是，用户行为的多样性，反映了用户兴趣的多样性，即每个人感兴趣的物品、种类是很多的，尤其是在淘宝这样综合性的购物网站。

此外，兴趣本身也会随着时间逐渐演化，前面提到的模型对于这种包含演化信息的数据，就更加无能为力了。

> 大家可以想象一下，自己在网络上购物，比如买衣服的时候，一年前喜欢的风格和现在喜欢的风格可能是不一样的，是存在一个逐渐演变的过程的，如果用前面提出的模型，会把这种逐渐演变的信息丢失掉。

我们利用了候选广告集，最终通过反向激活挖掘出历史行为中与候选广告相关的兴趣。
![](/img/post/20190204/5.png)

具体的模型设计如图：
![](/img/post/20190204/6.png)

- 通过候选广告，用反向激活的方式，与用户历史行为相关联，
- 按照候选广告与历史点击商品的相关性的高低，来赋予历史行为不同的权重。
- 通过这种方式获取到和当前广告相关的历史行为表达向量以及对应的相关权重，做weighted sum pooling之后，就得到了跟候选广告相关的用户兴趣向量表达。
- 这种方式比直接对所有历史行为做sum pooling增加了兴趣表达的灵活性，同时，随着候选广告的不同，该方式也会得到不同的兴趣表达。

如图是一个基于din所得到不同历史行为中包含的广告的权重的例子。候选广告是羽绒服，我们看到历史行为集中衣服相关的广告权重较高，而杯子之类的广告相关性很低。这个例子我们也可以看到din的优点。但是，从刚才的过程中，我们也发现到din还是有一些不足， 这个模型`忽略了兴趣随着时间之间演化`这样一个重要的性质。
![](/img/post/20190204/7.png)

#### DIEN模型

深度兴趣演化网络（Deep Interest Evolution Netowork）

首先，用户的兴趣随时间演化这样一个特点，做过深度学习的同学们会容易想到序列建模，即把历史行为按时间序列铺开做序列建模。这样一个直观的想法，我们当然也做过尝试，但是效果并不理想。

如图是一个用户的真实足迹，用户在看窗帘，突然买了别的产品；用户在看旅游产品，突然买了猫咪用品。
![](/img/post/20190204/8.png)

> 选购旅游产品的时间线一般拉的比较长，因此选购期间难免会看一些日常的其他商品。

这样一个行为序列是一个杂乱无章的过程，这样的序列与自然语言处理遇到的有序序列是完全不同的，在这样的场景下，`序列被打断`是一个常规行为。

因此单纯的序列建模在这种场景下会失败就不难理解了。用户的兴趣是隐藏在杂乱无章的行为序列背后的，针对这样的情况，我们提出了新的解决方案。
![](/img/post/20190204/9.png)





















