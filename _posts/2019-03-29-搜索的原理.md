---
layout:     post
title:      搜索的原理
subtitle:   The principle of "search"
date:       2019-03-29
author:     Jiayue Cai
header-img: img/post-bg-black.jpg
catalog: true
tags:
    - Search
    - C++
---

> Last updated on 2019-03-29... 未完待续

> [参考链接](https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&mid=2651962107&idx=1&sn=2704e234ccace7e3163dc7dbb46ca2e6&chksm=bd2d0f278a5a863180ef23737acd29759ce309568a27af2a1be144632b501b009109f012cc98&mpshare=1&scene=23&srcid=#rd)

### 核心结构

![](/img/post/20190329/1.png)

- 核心数据主要分为两部分（紫色部分）：web网页库、index索引数据。
- spider和search&index是相对工程的系统
- rank是和业务、策略紧密、算法相关的系统，搜索体验的差异主要在此，而业务、策略的优化是需要时间积累的

#### spider爬虫

- spider把互联网网页抓过来
- spider把互联网网页存储到网页库中（这个对存储的要求很高，要存储几乎整个“万维网”的镜像）

#### search&index索引与查询

建立索引与查询索引系统，这个系统又主要分为两部分：

一部分用于生成索引数据`build_index`
- build_index从网页库中读取数据，完成分词
- build_index生成倒排索引

一部分用于查询索引数据`search_index`
- search_index获得用户的搜索词，完成分词
- search_index查询倒排索引，获得“字符匹配”网页，这是初筛的结果

> [正/倒排索引](https://coladrill.github.io/2019/02/25/%E7%94%A8%E6%88%B7%E7%94%BB%E5%83%8F%E6%8A%80%E6%9C%AF/)

#### rank打分排序

输入：用户的搜索词。输出：排好序的第一页检索结果。
- rank对初筛的结果进行打分排序
- rank对排序后的第一页结果返回

### 检索的过程

> 分词、查倒排索引、求结果集交集

假设搜索词是“我爱”：

1、分词，“我爱”会分词为{我，爱}，时间复杂度为O(1)

2、每个分词后的item，从倒排索引查询包含这个item的网页list<url>，时间复杂度也是O(1)
- 我 -> {url1, url2}
- 爱 -> {url1, url2}

3、求list<url>的交集，就是符合所有查询词的结果网页，对于这个例子，{url1, url2}就是最终的查询结果

> 分词和倒排查询时间复杂度都是O(1)，整个搜索的时间复杂度取决于“求list<url>的交集”，问题转化为了求**两个集合交集**。

#### 两集合交集



